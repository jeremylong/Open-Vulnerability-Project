/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    // Apply the java Plugin to add support for Java.
    id 'java'
    id 'maven-publish'
    id 'signing'
    id 'com.diffplug.spotless'
    id 'com.github.spotbugs'
}

group 'io.github.jeremylong'
version = '1.0.0'

repositories {
    mavenCentral()
    gradlePluginPortal()
}

dependencies {

    compileOnly 'com.github.spotbugs:spotbugs-annotations:4.7.3'

    // Use JUnit Jupiter for testing.
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.2'
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
}

spotless {
    java {
        targetExclude(fileTree("$buildDir/generated") { include("**/*.java") })
        eclipse().configFile("$rootDir/buildSrc/src/main/config/spotless.eclipseformat.xml")
        licenseHeaderFile("$rootDir/buildSrc/src/main/config/java.license").updateYearWithLatest(true)
    }
}
spotlessJava.dependsOn 'compileJava'
spotlessJava.dependsOn 'compileTestJava'
spotbugsMain.dependsOn 'compileTestJava'
build.finalizedBy 'spotlessApply'

spotbugs {
    excludeFilter.set(file("$rootDir/buildSrc/src/main/config/spotbugs.exclude.xml"))
    reportsDir = file("$buildDir/spotbugs")
}
compileJava {
    sourceCompatibility = '1.8'
    targetCompatibility = '1.8'
    options.encoding = 'UTF-8'
}
tasks.withType(AbstractArchiveTask).configureEach {
    preserveFileTimestamps = false
    reproducibleFileOrder = true
}
javadoc {
    failOnError = false
    options.encoding("UTF-8")
    if (JavaVersion.current().isJava9Compatible()) {
        options.addBooleanOption('html5', true)
    }
}
java {
    withSourcesJar()
    withJavadocJar()
}
signing {
    sign publishing.publications
}
sourcesJar.dependsOn(compileJava)
sourcesJar.dependsOn(compileTestJava)
javadoc.dependsOn(compileTestJava)

publishing {
    repositories {
        maven {
            url "https://s01.oss.sonatype.org/service/local/staging/deploy/maven2"
            credentials {
                username project.findProperty('sonatypeUsername') ?: System.getenv("SONATYPE_USER")
                password project.findProperty('sonatypePassword') ?: System.getenv("SONATYPE_PASSWORD")
            }
        }
    }
}