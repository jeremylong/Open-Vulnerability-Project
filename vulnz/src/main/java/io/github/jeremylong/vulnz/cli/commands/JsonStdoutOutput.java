package io.github.jeremylong.vulnz.cli.commands;

class JsonStdoutOutput extends Output<Object> {
    private JsonGenerator jsonOut;
    public JsonStdoutOutput(String rootFieldName) {
        super();
        JsonFactory jfactory = objectMapper.getFactory();
        jsonOut = jfactory.createGenerator(System.out, JsonEncoding.UTF8);
        if (isPrettyPrint()) {
            jsonOut.useDefaultPrettyPrinter();
        }

        jsonOut.writeStartObject();
        jsonOut.writeFieldName(rootFieldName);
        jsonOut.writeStartArray();
    }

    @Override
    protected void writeOne(T t) throws Exception {
        jsonOut.writeObject(c);
    }

    @Override
    protected void done(BasicOutput output) {
        jsonOut.writeEndArray();
        jsonOut.writeObjectField("results", output);
        jsonOut.writeEndObject();
    }

    @Override
    protected void close() throws Exception {
        jsonOut.close();
    }
}