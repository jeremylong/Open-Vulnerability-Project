# gh-advisory-lib

A client for the GitHub GraphQL API to retrieve the GitHub Security Advisories.

The client requires a GitHub Personal Access Token to access the API.

## usage

### maven

```xml
<dependency>
   <groupId>io.github.jeremylong</groupId>
   <artifactId>gh-advisory-lib</artifactId>
   <version>2.0.1</version>
</dependency>
```

### gradle

```groovy
implementation 'io.github.jeremylong:gh-advisory-lib:2.0.1'
```

### building from source

```shell
./gradlew build
```

### api usage

The API is intended to be fairly simple; an example implementation is given below to retrieve the entire GitHub Security Advisory data
set - including a mechanism to keep the data up to date.

```java

import io.github.jeremylong.ghsa.GitHubSecurityAdvisoryClient;
import io.github.jeremylong.ghsa.GitHubSecurityAdvisoryClientBuilder;
import io.github.jeremylong.ghsa.SecurityAdvisory;

import java.time.ZoneOffset;
import java.time.ZonedDateTime;
import java.util.List;
        
public class Example {
    ZonedDateTime retrieveLastUpdated() {
        // TODO implement a storage/retrieval mechanism for the last updated date.

        return ZonedDateTime.now(ZoneOffset.UTC).minusDays(1);
    }

    void storeLastUpdated(ZonedDateTime lastUpdated) {
        // TODO implement a storage/retrieval mechanism for the last update time.
    }

    @Test
    void testNext() throws Exception {
        String apiKey = System.getenv("GITHUB_TOKEN");

        GitHubSecurityAdvisoryClientBuilder builder = GitHubSecurityAdvisoryClientBuilder
                .aGitHubSecurityAdvisoryClient()
                .withApiKey(apiKey);

        ZonedDateTime lastUpdated = retrieveLastUpdated();
        if (lastUpdated != null) {
            builder.withUpdatedSinceFilter(lastUpdated);
        }
        try (GitHubSecurityAdvisoryClient client = builder.build()) {
            if (client.hasNext()) {
                List<SecurityAdvisory> result = client.next();
                //TODO do something useful with the SecurityAdvisories
            }
            storeLastUpdated(client.getLastUpdated());
        }
    }
}
```
